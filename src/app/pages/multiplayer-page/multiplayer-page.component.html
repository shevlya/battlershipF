<div class="multiplayer-container">
    <!-- Кнопка возврата в лобби в левом верхнем углу -->
    <a routerLink="/lobby" class="lobby-button">Вернуться в лобби</a>
    
    <div class="multiplayer-card">
        <!-- Сообщение об ошибке -->
        @if(error) {
            <div class="error-message">
                <div class="error-text">{{ error }}</div>
            </div>
        }

        <!-- Индикатор загрузки -->
        @if(loading && players.length === 0) {
            <div class="loading-message">
                <div class="loading-text">Загрузка игроков...</div>
            </div>
        }

        <!-- Сообщение если нет игроков -->
        @if(!loading && players.length === 0) {
            <div class="empty-message">
                <div class="empty-text">Нет доступных игроков</div>
            </div>
        }

        <div class="players-table" *ngIf="players.length > 0">
            <div class="table-header">
                <span class="header-player">Выберите игрока</span>
            </div>
            
            <ul class="players-list">
                <li class="player-row" *ngFor="let player of paginatedPlayers">
                    <div class="player-option" 
                         [class.selected]="selectedPlayerId === player.playerId"
                         (click)="selectPlayer(player.playerId)">
                        <div class="player-info">
                            <div class="avatar-container">
                                <!-- Если есть аватар - показываем изображение -->
                                @if(player.avatarUrl) {
                                    <img [src]="getAvatarPath(player.avatarUrl)" 
                                         [alt]="player.nickname" 
                                         class="avatar-image"
                                         (error)="player.avatarUrl = null">
                                }
                                <!-- Если нет аватара - показываем цветной круг с инициалами -->
                                @if(!player.avatarUrl) {
                                    <div class="avatar-placeholder" [style.background-color]="getAvatarColor(player.nickname)">
                                        {{ getInitials(player.nickname) }}
                                    </div>
                                }
                            </div>
                            <span class="username">{{ player.nickname }}</span>
                        </div>
                    </div>
                </li>
            </ul>

            <!-- Пагинация -->
            <div class="pagination" *ngIf="totalPages > 1">
                <button class="pagination-btn" 
                        (click)="previousPage()" 
                        [disabled]="currentPage === 1">
                    ←
                </button>
                
                <div class="page-numbers">
                    <span *ngFor="let page of getPageNumbers()" 
                          class="page-number"
                          [class.active]="page === currentPage"
                          (click)="goToPage(page)">
                        {{ page }}
                    </span>
                </div>
                
                <button class="pagination-btn" 
                        (click)="nextPage()" 
                        [disabled]="currentPage === totalPages">
                    →
                </button>
            </div>
        </div>
    </div>

    <!-- Кнопка приглашения вынесена за пределы основной плашки -->
    <div class="invite-container" *ngIf="players.length > 0">
        <button class="invite-btn" 
                (click)="inviteSelectedPlayer()"
                [disabled]="!selectedPlayerId">
            Пригласить выбранного игрока
        </button>
    </div>
</div>